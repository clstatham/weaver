@startup
system setup {
    create_player(100)
}

impl Player {
    func new() -> Player {
        return Player {
            transform: Transform.new(),
            vel: vec3(0, 0, 0),
        }
    }

    func print(self: Player) {
        print("Player {")
        print("    pos =", self.transform.get_translation())
        print("    rot =", self.transform.get_rotation())
        print("    vel =", self.vel)
        print("}")
    }
}

func create_player(hp: Int) -> Entity {
    spawn(
        Player.new(),
        Health {
            hp: hp,
        },
    )
}

@update
system update {
    let res time: Time
    time.update()
    let dt = time.delta_seconds
    print("dt =", dt)
    let dt = vec3(dt, dt, dt)

    loop query _ [
        var player: Player,
    ] {
        player.vel += vec3(0, -9.81, 0) * dt
        player.transform.translate(player.vel * dt)
        player.print()
    }
}
